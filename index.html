<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mutant Elite 11.0: Synthesis Lab</title>
    <style>
        :root { 
            --p: #00f2fe; --g: #4dfa66; --y: #f1c40f; --r: #ff0055; 
            --bg: #010103; --card: rgba(20, 20, 35, 0.95);
        }
        
        body { 
            text-align: center; font-family: 'Orbitron', sans-serif; 
            background: var(--bg); color: white; margin: 0; overflow: hidden; height: 100vh;
            user-select: none;
        }

        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        .top-bar { 
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0, 0, 0, 0.9); padding: 10px 20px; 
            border-bottom: 2px solid var(--p); backdrop-filter: blur(15px);
            position: relative; z-index: 500;
        }

        .cases-wrapper {
            position: fixed; left: 0; top: 70px; bottom: 0; width: 130px;
            background: rgba(0,0,0,0.5); border-right: 1px solid rgba(0,242,254,0.3);
            z-index: 400; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--p) transparent;
        }

        .case-list { padding: 10px; display: flex; flex-direction: column; gap: 15px; }

        .case-card { 
            width: 100%; aspect-ratio: 1/1; background: var(--card); 
            border: 2px solid; border-radius: 12px; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 9px; transition: 0.2s;
        }
        .case-card:hover { transform: translateX(5px); }

        #btn { 
            width: 150px; height: 150px; border-radius: 50%; border: 4px solid #fff; 
            position: absolute; cursor: pointer; font-weight: 900; 
            z-index: 10; background: radial-gradient(circle, var(--p), #000);
            color: #fff; box-shadow: 0 0 30px var(--p); display: none;
            align-items: center; justify-content: center; transform: translate(-50%, -50%);
        }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal { background: #0a0a15; padding: 25px; border-radius: 20px; border: 1px solid var(--p); width: 90%; max-width: 450px; max-height: 85vh; overflow-y: auto; }

        .inv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .inv-item { background: #111; padding: 10px; border-radius: 10px; border: 1px solid #333; cursor: pointer; position: relative; }
        .inv-item.selected { border-color: var(--y); box-shadow: 0 0 10px var(--y); }

        .btn-action { background: var(--p); color: #000; border: none; padding: 12px; border-radius: 8px; font-weight: 900; cursor: pointer; width: 100%; margin-top: 10px; }
        .craft-cost { color: var(--y); font-size: 14px; margin: 10px 0; }
        
        #xp-bar { position: fixed; bottom: 0; height: 10px; width: 0%; background: linear-gradient(90deg, var(--p), #ff00ff); transition: 0.3s; z-index: 1000; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
</head>
<body>

<canvas id="canvas"></canvas>

<div id="auth-screen" class="overlay" style="display:flex;">
    <div class="modal">
        <h2 style="color:var(--p)">MUTANT ELITE 11.0</h2>
        <input type="text" id="nick" placeholder="–ù–Ü–ö–ù–ï–ô–ú" style="width:100%; padding:10px; margin:10px 0; background:#000; border:1px solid var(--p); color:#fff; border-radius:8px; box-sizing: border-box;">
        <input type="password" id="pass" placeholder="–ü–ê–†–û–õ–¨" style="width:100%; padding:10px; margin:10px 0; background:#000; border:1px solid var(--p); color:#fff; border-radius:8px; box-sizing: border-box;">
        <button class="btn-action" onclick="handleAuth()">–£–í–Ü–ô–¢–ò</button>
    </div>
</div>

<div class="top-bar">
    <div style="text-align:left">
        <div style="color:var(--p); font-size:10px;">üß¨ LVL <span id="lvl">1</span></div>
        <div style="color:var(--y); font-size:18px; font-weight:900;">$ <span id="score">0</span></div>
    </div>
    <div style="display:flex; gap:10px;">
        <button onclick="toggleCraft()" style="background:var(--y); border:none; padding:8px 15px; border-radius:5px; font-weight:900; cursor:pointer;">CRAFT</button>
        <button onclick="toggleInv()" style="background:var(--p); border:none; padding:8px 15px; border-radius:5px; font-weight:900; cursor:pointer;">BANK</button>
    </div>
</div>

<div class="cases-wrapper">
    <div class="case-list" id="case-list"></div>
</div>

<div id="xp-bar"></div>
<button id="btn">MUTATE</button>

<div id="craft-panel" class="overlay">
    <div class="modal">
        <h3 style="color:var(--y)">–õ–ê–ë–û–†–ê–¢–û–†–Ü–Ø –°–ò–ù–¢–ï–ó–£</h3>
        <p style="font-size:10px">–û–±–µ—Ä—ñ—Ç—å 2 –º—É—Ç–∞–Ω—Ç–∏ –¥–ª—è –æ–±'—î–¥–Ω–∞–Ω–Ω—è</p>
        <div id="craft-list" class="inv-grid"></div>
        <div class="craft-cost" id="craft-price">–¶—ñ–Ω–∞: $0</div>
        <button class="btn-action" id="craft-btn" onclick="startCraft()" style="background:var(--y)">–°–ò–ù–¢–ï–ó–£–í–ê–¢–ò</button>
        <button class="btn-action" style="background:#444; color:#fff" onclick="toggleCraft()">–°–ö–ê–°–£–í–ê–¢–ò</button>
    </div>
</div>

<div id="inv-panel" class="overlay">
    <div class="modal">
        <h3 style="color:var(--p)">–í–ê–®–Ü –ì–ï–ù–ò</h3>
        <div id="inv-list"></div>
        <button class="btn-action" style="background:#444; color:#fff" onclick="toggleInv()">–ó–ê–ö–†–ò–¢–ò</button>
    </div>
</div>

<script>
    let score = 0, power = 1, lvl = 1, xp = 0, currentUser = "";
    let inventory = [{n: "–ê—Ç–æ–º–∞—Ä–Ω–∞ –ö–ª—ñ—Ç–∏–Ω–∞", p: 1, c: "#fff"}];
    let selectedForCraft = [];

    const ICONS = ["üì¶","üß™","‚ò¢Ô∏è","‚ò£Ô∏è","üíæ","üî•","‚ö°","üíé","üõ∞Ô∏è","üõ∏","üåå","üåë","üåÄ","‚öõÔ∏è","üîÆ","üëπ","üê≤","üëë","‚õ©Ô∏è","üëÅÔ∏è"];
    const COLORS = ["#888", "#4dfa66", "#00f2fe", "#bc13fe", "#ff0055", "#ffd700", "#ffffff"];
    const CASE_DATA = [];
    for(let i=0; i<50; i++) {
        CASE_DATA.push({
            id: i, n: "–ö–µ–π—Å #" + (i+1), cost: Math.floor(100 * Math.pow(1.8, i)),
            min: Math.floor(2 * Math.pow(1.7, i)), col: COLORS[Math.floor(i/7)] || "#ff00ff", ico: ICONS[i % ICONS.length]
        });
    }

    function handleAuth() {
        const nick = document.getElementById('nick').value.trim();
        const pass = document.getElementById('pass').value.trim();
        if(!nick || !pass) return;
        let accs = JSON.parse(localStorage.getItem('mutant_v11_saves') || '{}');
        if(accs[nick]) {
            if(accs[nick].pass !== pass) return alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å!");
            loadData(nick, accs[nick]);
        } else {
            accs[nick] = { pass, score: 0, lvl: 1, xp: 0, inventory: [...inventory] };
            localStorage.setItem('mutant_v11_saves', JSON.stringify(accs));
            loadData(nick, accs[nick]);
        }
    }

    function loadData(nick, data) {
        currentUser = nick; score = data.score; lvl = data.lvl; xp = data.xp; inventory = data.inventory;
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('btn').style.display = 'flex';
        renderCases(); updateUI(); moveBtn();
        setInterval(() => { score += (lvl * 5); updateUI(); }, 1000);
        setInterval(saveGame, 5000);
    }

    function saveGame() {
        if(!currentUser) return;
        let accs = JSON.parse(localStorage.getItem('mutant_v11_saves') || '{}');
        accs[currentUser] = { pass: accs[currentUser].pass, score, lvl, xp, inventory };
        localStorage.setItem('mutant_v11_saves', JSON.stringify(accs));
    }

    function renderCases() {
        document.getElementById('case-list').innerHTML = CASE_DATA.map((c, i) => `
            <div class="case-card" onclick="buyCase(${i})" style="border-color:${c.col}">
                <span style="font-size:20px">${c.ico}</span>
                <b>${c.n}</b>
                <span style="color:var(--y)">$${formatNum(c.cost)}</span>
            </div>
        `).join('');
    }

    function buyCase(i) {
        const c = CASE_DATA[i];
        if(score < c.cost) return alert("–ú–∞–ª–æ –≥—Ä–æ—à–µ–π!");
        score -= c.cost;
        const pwr = Math.floor(c.min * (1 + Math.random() * 2));
        inventory.push({ n: "–ú—É—Ç–∞–Ω—Ç " + c.ico, p: pwr, c: c.col });
        updateUI();
        alert("–û—Ç—Ä–∏–º–∞–Ω–æ: –ú—É—Ç–∞–Ω—Ç –∑ —Å–∏–ª–æ—é " + formatNum(pwr));
    }

    // CRAFT LOGIC
    function toggleCraft() {
        const p = document.getElementById('craft-panel');
        p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
        selectedForCraft = [];
        if(p.style.display === 'flex') renderCraftList();
        updateCraftPrice();
    }

    function renderCraftList() {
        const list = document.getElementById('craft-list');
        list.innerHTML = inventory.map((item, i) => `
            <div class="inv-item" id="craft-item-${i}" onclick="selectForCraft(${i})">
                <div style="color:${item.c}">${item.n}</div>
                <div style="font-size:10px">PWR: ${formatNum(item.p)}</div>
            </div>
        `).join('');
    }

    function selectForCraft(i) {
        const idx = selectedForCraft.indexOf(i);
        if(idx > -1) {
            selectedForCraft.splice(idx, 1);
            document.getElementById(`craft-item-${i}`).classList.remove('selected');
        } else if(selectedForCraft.length < 2) {
            selectedForCraft.push(i);
            document.getElementById(`craft-item-${i}`).classList.add('selected');
        }
        updateCraftPrice();
    }

    function updateCraftPrice() {
        let price = 0;
        if(selectedForCraft.length === 2) {
            const p1 = inventory[selectedForCraft[0]].p;
            const p2 = inventory[selectedForCraft[1]].p;
            price = Math.floor((p1 + p2) * 10); // –¶—ñ–Ω–∞ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å–∏–ª–∏
        }
        document.getElementById('craft-price').innerText = `–¶—ñ–Ω–∞ —Å–∏–Ω—Ç–µ–∑—É: $${formatNum(price)}`;
        return price;
    }

    function startCraft() {
        if(selectedForCraft.length < 2) return alert("–û–±–µ—Ä—ñ—Ç—å 2 –º—É—Ç–∞–Ω—Ç–∏!");
        const price = updateCraftPrice();
        if(score < price) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—Ä–æ—à–µ–π –¥–ª—è —Å–∏–Ω—Ç–µ–∑—É!");

        score -= price;
        const m1 = inventory[selectedForCraft[0]];
        const m2 = inventory[selectedForCraft[1]];
        
        const newPwr = Math.floor((m1.p + m2.p) * (1.2 + Math.random() * 0.3));
        const newMut = { n: "–ì—ñ–±—Ä–∏–¥-X", p: newPwr, c: "#ff00ff" };

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è (—Å–ø–æ—á–∞—Ç–∫—É –±—ñ–ª—å—à–∏–π —ñ–Ω–¥–µ–∫—Å, —â–æ–± –Ω–µ –∑–±–∏–≤—Å—è —Å–ø–∏—Å–æ–∫)
        const sortedIndices = [...selectedForCraft].sort((a,b) => b-a);
        inventory.splice(sortedIndices[0], 1);
        inventory.splice(sortedIndices[1], 1);
        
        inventory.unshift(newMut);
        alert(`–£—Å–ø—ñ—Ö! –°—Ç–≤–æ—Ä–µ–Ω–æ –≥—ñ–±—Ä–∏–¥ —Å–∏–ª–æ—é ${formatNum(newPwr)}`);
        toggleCraft();
        updateUI();
    }

    const clickBtn = document.getElementById('btn');
    clickBtn.onclick = (e) => {
        let gain = Math.floor(power * (1 + lvl * 0.3) * (Math.random() < 0.1 ? 5 : 1));
        score += gain; xp += 40;
        createFloat(e.clientX, e.clientY, `+${formatNum(gain)}`, "#fff");
        if(xp >= lvl * 1000) { lvl++; xp = 0; }
        updateUI(); moveBtn();
    };

    function updateUI() {
        document.getElementById('score').innerText = formatNum(score);
        document.getElementById('lvl').innerText = lvl;
        document.getElementById('xp-bar').style.width = (xp / (lvl * 1000)) * 100 + "%";
    }

    function formatNum(n) {
        if(n >= 1e9) return (n/1e9).toFixed(1) + 'B';
        if(n >= 1e6) return (n/1e6).toFixed(1) + 'M';
        if(n >= 1e3) return (n/1e3).toFixed(1) + 'k';
        return Math.floor(n);
    }

    function moveBtn() {
        const x = Math.random() * (window.innerWidth - 300) + 150;
        const y = Math.random() * (window.innerHeight - 300) + 150;
        clickBtn.style.left = x + 'px';
        clickBtn.style.top = y + 'px';
    }

    function toggleInv() {
        const p = document.getElementById('inv-panel');
        p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
        if(p.style.display === 'flex') {
            document.getElementById('inv-list').innerHTML = inventory.slice().reverse().map(item => `
                <div style="background:#111; padding:10px; margin:5px 0; border-left:4px solid ${item.c}; display:flex; justify-content:space-between;">
                    <span>PWR: ${formatNum(item.p)}</span>
                    <button onclick="power=${item.p}; toggleInv();" style="background:var(--g); border:none; padding:5px; border-radius:3px; cursor:pointer;">USE</button>
                </div>
            `).join('');
        }
    }

    function createFloat(x, y, t, c) {
        const el = document.createElement('div');
        el.style.cssText = `position:fixed; left:${x}px; top:${y}px; color:${c}; font-weight:900; pointer-events:none; animation: up 0.7s forwards; z-index:1000;`;
        el.innerText = t; document.body.appendChild(el);
        setTimeout(() => el.remove(), 700);
    }

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resize; resize();
    function anim() {
        ctx.fillStyle = 'rgba(1, 1, 3, 0.2)';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        requestAnimationFrame(anim);
    }
    anim();
</script>

<style>
    @keyframes up { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-80px); opacity: 0; } }
</style>

</body>
</html>